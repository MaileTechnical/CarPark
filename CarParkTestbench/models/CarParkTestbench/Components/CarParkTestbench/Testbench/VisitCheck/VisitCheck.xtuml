-- BP 7.1.6 content: ModelClass syschar: 3 persistence-version: 7.1.6

INSERT INTO O_OBJ
	VALUES ("4fcf002f-293e-439e-8797-150b17c09a95",
	'VisitCheck',
	40,
	'VisitCheck',
	'Observe that a ticket is returned at a pay station.
It may be returned due to cancellation as well as full payment.',
	"00000000-0000-0000-0000-000000000000");
INSERT INTO O_TFR
	VALUES ("b41f439d-7751-4d2b-8075-5a2b157fb38e",
	"4fcf002f-293e-439e-8797-150b17c09a95",
	'Create',
	'Add an observation of this type to the ''script'' of a test case.
See Observation.AppendPolling for description.',
	"ba5eda7a-def5-0000-0000-000000000000",
	0,
	'create object instance check of VisitCheck;
check.ticketNumber = param.ticket;
check.payDisposition = param.payment;
check.changeDisposition = param.change; 
check.deadlineStatus = param.deadlineStatus;

create object instance obs of Observation;
relate check to obs across R400;

obs.AddImmediate( seqLabel:param.seqLabel, pollInterval:0, timeLimit:0, concurrent:True );',
	1,
	'',
	"00000000-0000-0000-0000-000000000000",
	0);
INSERT INTO O_TPARM
	VALUES ("8c6ad10a-09e1-4bae-83d3-f43764e13b9a",
	"b41f439d-7751-4d2b-8075-5a2b157fb38e",
	'ticket',
	"ba5eda7a-def5-0000-0000-000000000002",
	0,
	'',
	"95a68d07-1ffb-4a33-b721-29b0a0a3db1a",
	'');
INSERT INTO O_TPARM
	VALUES ("95a68d07-1ffb-4a33-b721-29b0a0a3db1a",
	"b41f439d-7751-4d2b-8075-5a2b157fb38e",
	'seqLabel',
	"ba5eda7a-def5-0000-0000-000000000004",
	0,
	'',
	"00000000-0000-0000-0000-000000000000",
	'');
INSERT INTO O_TPARM
	VALUES ("26d0e501-3fed-49fa-b435-41eafec184fe",
	"b41f439d-7751-4d2b-8075-5a2b157fb38e",
	'payment',
	"ded3bca0-4d1e-414f-8227-dc8fc8fd64d9",
	0,
	'',
	"8c6ad10a-09e1-4bae-83d3-f43764e13b9a",
	'');
INSERT INTO S_DT_PROXY
	VALUES ("ded3bca0-4d1e-414f-8227-dc8fc8fd64d9",
	"00000000-0000-0000-0000-000000000000",
	'PayStatus',
	'If not "ignored" must be matched by checking observation.',
	'',
	'../../Types/Types.xtuml');
INSERT INTO O_TPARM
	VALUES ("58b72733-f24a-48d2-a77d-0e2055835d4c",
	"b41f439d-7751-4d2b-8075-5a2b157fb38e",
	'change',
	"44e7f67d-7896-4de3-b311-9aee3cb5b226",
	0,
	'',
	"26d0e501-3fed-49fa-b435-41eafec184fe",
	'');
INSERT INTO S_DT_PROXY
	VALUES ("44e7f67d-7896-4de3-b311-9aee3cb5b226",
	"00000000-0000-0000-0000-000000000000",
	'ChangeStatus',
	'If not "ignored" must be matched by checking observation.',
	'',
	'../../Types/Types.xtuml');
INSERT INTO O_TPARM
	VALUES ("757f7522-a8c2-494d-b3e8-aa6d4802b5d1",
	"b41f439d-7751-4d2b-8075-5a2b157fb38e",
	'deadlineStatus',
	"01e593e1-d9ae-4124-b4c0-98d3952a808a",
	0,
	'',
	"58b72733-f24a-48d2-a77d-0e2055835d4c",
	'');
INSERT INTO S_DT_PROXY
	VALUES ("01e593e1-d9ae-4124-b4c0-98d3952a808a",
	"00000000-0000-0000-0000-000000000000",
	'DeadlineStatus',
	'If not "ignored" must be matched by checking observation.',
	'',
	'../../Types/Types.xtuml');
INSERT INTO O_TFR
	VALUES ("71acc951-8272-43fc-ac78-6267bc2036ab",
	"4fcf002f-293e-439e-8797-150b17c09a95",
	'CheckTracking',
	'When invoked, search any existing notifications looking for a match.',
	"ba5eda7a-def5-0000-0000-000000000000",
	1,
	'select one observation related by self->Observation[R400]; 

success = true;
now = TIM::current_seconds();
select any tracker from instances of VisitTracking
 where ( selected.ticketNumber == self.ticketNumber );
if ( not_empty tracker )
  if ( self.deadlineStatus != DeadlineStatus::ignore )
    if ( self.deadlineStatus == DeadlineStatus::valid )
     and ( now >= tracker.deadline )
      success = false;
    else
      if ( self.deadlineStatus == DeadlineStatus::expired )
       and ( now < tracker.deadline )
        success = false;
      end if;
    end if;
  end if;
  if ( self.payDisposition != PayStatus::ignore )
    if ( self.payDisposition != tracker.payStatus )
      success = false;
    end if;
  end if;
  if ( self.changeDisposition != ChangeStatus::ignore )
    if ( self.changeDisposition != tracker.changeStatus )
      success = false;
    end if;
  end if;
else
  success = false;
end if;
if ( success )
  LOG::LogSuccess( message:"Visit data checked OK." );
  observation.Complete( success:True );
else
  observation.Complete( success:False );
end if;
',
	1,
	'',
	"b41f439d-7751-4d2b-8075-5a2b157fb38e",
	0);
INSERT INTO O_NBATTR
	VALUES ("066b3ce0-ff48-4946-9cab-8b01225d5e80",
	"4fcf002f-293e-439e-8797-150b17c09a95");
INSERT INTO O_BATTR
	VALUES ("066b3ce0-ff48-4946-9cab-8b01225d5e80",
	"4fcf002f-293e-439e-8797-150b17c09a95");
INSERT INTO O_ATTR
	VALUES ("066b3ce0-ff48-4946-9cab-8b01225d5e80",
	"4fcf002f-293e-439e-8797-150b17c09a95",
	"b844e7b6-6488-419f-a733-ab295ec9ffb7",
	'deadlineStatus',
	'If true, check exit deadline against current time.',
	'',
	'deadlineStatus',
	0,
	"01e593e1-d9ae-4124-b4c0-98d3952a808a",
	'',
	'');
INSERT INTO O_NBATTR
	VALUES ("b844e7b6-6488-419f-a733-ab295ec9ffb7",
	"4fcf002f-293e-439e-8797-150b17c09a95");
INSERT INTO O_BATTR
	VALUES ("b844e7b6-6488-419f-a733-ab295ec9ffb7",
	"4fcf002f-293e-439e-8797-150b17c09a95");
INSERT INTO O_ATTR
	VALUES ("b844e7b6-6488-419f-a733-ab295ec9ffb7",
	"4fcf002f-293e-439e-8797-150b17c09a95",
	"00000000-0000-0000-0000-000000000000",
	'ticketNumber',
	'',
	'',
	'ticketNumber',
	0,
	"ba5eda7a-def5-0000-0000-000000000002",
	'',
	'');
INSERT INTO O_NBATTR
	VALUES ("ccdf81e2-3838-4e0f-824d-257c2e039fa7",
	"4fcf002f-293e-439e-8797-150b17c09a95");
INSERT INTO O_BATTR
	VALUES ("ccdf81e2-3838-4e0f-824d-257c2e039fa7",
	"4fcf002f-293e-439e-8797-150b17c09a95");
INSERT INTO O_ATTR
	VALUES ("ccdf81e2-3838-4e0f-824d-257c2e039fa7",
	"4fcf002f-293e-439e-8797-150b17c09a95",
	"066b3ce0-ff48-4946-9cab-8b01225d5e80",
	'payDisposition',
	'',
	'',
	'payDisposition',
	0,
	"ded3bca0-4d1e-414f-8227-dc8fc8fd64d9",
	'',
	'');
INSERT INTO O_NBATTR
	VALUES ("c138b3d2-c56a-4905-b4df-18893c64820a",
	"4fcf002f-293e-439e-8797-150b17c09a95");
INSERT INTO O_BATTR
	VALUES ("c138b3d2-c56a-4905-b4df-18893c64820a",
	"4fcf002f-293e-439e-8797-150b17c09a95");
INSERT INTO O_ATTR
	VALUES ("c138b3d2-c56a-4905-b4df-18893c64820a",
	"4fcf002f-293e-439e-8797-150b17c09a95",
	"ccdf81e2-3838-4e0f-824d-257c2e039fa7",
	'changeDisposition',
	'',
	'',
	'changeDisposition',
	0,
	"44e7f67d-7896-4de3-b311-9aee3cb5b226",
	'',
	'');
INSERT INTO O_ID
	VALUES (0,
	"4fcf002f-293e-439e-8797-150b17c09a95");
INSERT INTO O_ID
	VALUES (1,
	"4fcf002f-293e-439e-8797-150b17c09a95");
INSERT INTO O_ID
	VALUES (2,
	"4fcf002f-293e-439e-8797-150b17c09a95");
INSERT INTO PE_PE
	VALUES ("4fcf002f-293e-439e-8797-150b17c09a95",
	1,
	"3430745e-1746-4e96-ac58-2ee3ee684b20",
	"00000000-0000-0000-0000-000000000000",
	4);
INSERT INTO EP_PKG_PROXY
	VALUES ("3430745e-1746-4e96-ac58-2ee3ee684b20",
	"00000000-0000-0000-0000-000000000000",
	"87ff681e-390e-45ca-9f9c-e0259790ea6c",
	'Testbench',
	'',
	0,
	'../Testbench.xtuml');
